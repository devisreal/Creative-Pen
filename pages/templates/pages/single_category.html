{% extends 'base.html' %}
{% load static %}
{% block title %}
Category - {{category.name}}
{% endblock title %}
{% block styles %}
<style>

</style>
{% endblock styles %}
{% block content %}
{% include 'partials/messages.html' %}


<section class="">
   <div class="">
      <div class="row">
         <div class="col-12">
            <div class="card bg-dark-overlay-4 overflow-hidden h-350 text-center rounded-0 border-0" 
               {% if category.category_image %} style="
                  background-position: center left; 
                  background-size: cover; 
                  background-image: url('{{category.category_image.url}}');
               " {% else %} style="
                  background-position: center left; 
                  background-size: cover; 
                  background-image: url('{% static " img/user/bkg_placeholder1.jpg" %}'); "
               {% endif %}
            >
               <!-- Card Image overlay -->
               <div class=" card-img-overlay d-flex align-items-center p-3 p-sm-4">
               <div class="w-100 my-auto">
                  <p class="text-white mb-3">
                     Browsing category:
                  </p>
                  <h1 class="text-white h5">
                     <span {% if category.color %}
                        class="badge text-bg-{{category.color}} mb-2 font-medium text-capitalize" {% else %}
                        class="badge text-bg-dark mb-2 font-medium text-capitalize" {% endif %}>
                        <i class="fa-solid fa-layer-group me-2 "></i>
                        {{category.name}}
                     </span>
                  </h1>
                  <div class="text-center position-relative">
                     <span class="badge text-bg-light text-sm font-outfit font-medium">14 posts</span>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   </div>
</section>


{% if category_posts %}
   
<div class="container mt-5 pt-5">
   <div class="row gy-4" data-masonry='{"percentPosition": true }'>

      {% for post in category_posts %}


      <div class="col-sm-6 col-lg-4 ">
         <div class="card border-0 ">
            <!-- Card img -->
            <div class="position-relative ">
               <img class="card-img pointer-events-none" src="{{post.post_image.url}}" alt="Card image">
               <div class="card-img-overlay d-flex align-items-start flex-column p-3">
                  <!-- Card overlay Top -->
                  <div class="w-100 mb-auto d-flex justify-content-end">
                     <div class="text-end ms-auto">
                        <!-- * Post Type -->
                        {% if post.post_type == video %}
                        <div class="icon-md bg-white bg-opacity-25 bg-blur text-white rounded-circle" data-bs-toggle="tooltip"
                           data-bs-title="This post has video" data-bs-placement="right">
                           <i class="fas fa-video"></i>
                        </div>
                        {% elif post.post_type == video %}
                        <div class="icon-md bg-white bg-opacity-25 bg-blur text-white rounded-circle" data-bs-toggle="tooltip"
                           data-bs-title="This post has video" data-bs-placement="right">
                           <i class="fa-solid fa-images text-md"></i>
                        </div>
                        {% endif %}
                     </div>
                  </div>
                  <!-- Card overlay bottom -->
                  <div class="w-100 mt-auto">
                     <!-- Card category -->
                     <a href="{% url 'category' post.category.slug %}"
                        class="badge text-xs text-bg-{{post.category.color}} mb-2 text-decoration-none font-outfit font-medium">
                        <i class="fa-solid fa-layer-group me-2"></i> {{post.category}}
                     </a>
                  </div>
               </div>
            </div>
            <div class="card-body px-0 pt-3">
               <div class="d-sm-flex justify-content-between">
                  <h4 class="card-title m-0 p-0 pb-2">
                     <a href="{% url 'blog:single_post' post.slug %}" class="btn-link text-reset fw-bold">
                        {{post.post_title}}
                     </a>
                  </h4>
      
                  {% if request.user.is_authenticated %}
                  <div class="w-fit col-1">
      
                     {% if request.user in post.bookmarks.all %}
                     <a href="{% url 'users:bookmark_add' request.user.slug post.id %}" class="text-decoration-none"
                        data-bs-toggle="tooltip" data-bs-title="Remove from bookmarks" data-bs-placement="bottom">
                        <i class="iconsax" style="--Iconsax-Size: 24px;--Iconsax-Color: #000;" icon-name="bookmark-slash"></i>
                     </a>
                     {% else %}
                     <a href="{% url 'users:bookmark_add' request.user.slug post.id %}" class="text-decoration-none"
                        data-bs-toggle="tooltip" data-bs-title="Add to bookmarks" data-bs-placement="bottom">
                        <i class="iconsax" style="--Iconsax-Size: 24px;--Iconsax-Color: #000;" icon-name="bookmark-add"></i>
                     </a>
                     {% endif %}
      
                  </div>
                  {% else %}
                  <div class="w-fit col-1">
                     <a href="{% url 'login' %}" class="text-decoration-none" data-bs-toggle="tooltip"
                        data-bs-title="Add to bookmarks" data-bs-placement="bottom">
                        <i class="iconsax" style="--Iconsax-Size: 24px;--Iconsax-Color: #000;" icon-name="bookmark-add"></i>
                     </a>
                  </div>
                  {% endif %}
               </div>
               <p class="card-text">
                  {{post.short_description}}
               </p>
               <!-- Card info -->
               <ul class="nav nav-divider align-items-center d-none d-sm-inline-block">
                  <li class="nav-item">
                     <div class="nav-link">
                        <div class="d-flex align-items-center position-relative">
                           <div class="avatar avatar-xs">
                              {% if post.post_author.profile_picture %}
                              <img class="avatar-img rounded-circle" src="{{post.post_author.profile_picture.url}}"
                                 alt="avatar">
                              {% else %}
                              <img class="avatar-img rounded-circle" src="{% static 'img/user/custom.jpg' %}" alt="avatar">
                              {% endif %}
                           </div>
                           <span class="ms-3">by
                              <a href="{% url 'author_external' post.post_author.slug %}"
                                 class="stretched-link text-reset btn-link">
                                 {{post.post_author.get_short_name}}
                              </a>
                           </span>
                        </div>
                     </div>
                  </li>
                  <li class="nav-item">
                     {{post.date_posted|date:"dS M , Y"}}
                  </li>
                  <li class="nav-item">
                     <a href="#" class="btn-link">
                        <i class="fa-regular fa-comments me-1"></i> 5
                     </a>
                  </li>
               </ul>
            </div>
         </div>
      </div>

      {% endfor %}
   </div>
</div>

{% else %}

<div class="d-grid justify-content-center py-5 mt-5">
   <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto" width="70" height="70" fill="#dc2626" viewBox="0 0 24 24">
      <path
         d="M11.953 2C6.465 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.493 2 11.953 2zM12 20c-4.411 0-8-3.589-8-8s3.567-8 7.953-8C16.391 4 20 7.589 20 12s-3.589 8-8 8z">
      </path>
      <path d="M11 7h2v7h-2zm0 8h2v2h-2z"></path>
   </svg>
   <h4 class="text-center mt-3">No Posts</h4>
   <p>There are no posts under this category.</p>
</div>

{% endif %}

{% endblock %}