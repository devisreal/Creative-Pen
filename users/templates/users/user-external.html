{% extends 'base.html' %}
{% load static %}
{% block title %}
{% if author%}
{{author.username}} ({{author.get_full_name}})
{% elif reader %}
{{reader.username}} ({{reader.get_full_name}})
{% endif %}
{% endblock title %}
{% block styles %}
<style>
   :root {
      --Iconsax-Size: 20px;
      --Iconsax-Color: rgba(0, 0, 0, 0.7);
   }

   .background-img {
      filter: brightness(0.8);
      background-size: cover;
      background-position: center;
      object-fit: cover;
   }
</style>
{% endblock styles %}
{% block content %}
{% include 'partials/messages.html' %}

{% if author %}

<div class="author-info py-4 pt-4 px-2 bg-light text-center border-bottom">
   <div class="avatar avatar-xxl mb-3">
      {% if author.profile_picture %}
      <img class="avatar-img rounded-circle border-0 pointer-events-none" src="{{author.profile_picture.url}}" alt="">
      {% else %}
      <img class="avatar-img rounded-circle border-0 pointer-events-none" src="{% static 'img/user/custom.jpg' %}"
         alt="">
      {% endif %}
   </div>
   <h2 class="font-semibold mb-0">Hi, I'm {{author.get_full_name}}</h2>
   <small class="font-medium text-gray-500">
      @{{author.get_username}}
   </small>
   <ul class="list-inline my-1">
      {% if author.job_title %}
      <li class="list-inline-item">
         <small class="d-block text-gray-500 text-sm">
            <i class="fa-solid fa-user fa-sm me-1"></i>
            {{author.job_title|default:""}}
         </small>
      </li>
      {% endif %}
      {% if author.city %}
      <li class="list-inline-item">
         <small class="d-block text-gray-500 text-sm">
            <i class="fa-solid fa-location-dot fa-sm me-1"></i>
            {{author.city|default:""}}
         </small>
      </li>
      {% endif %}
   </ul>
   <small class="bg-red py-1 px-2 rounded-pill text-white badge font-medium">
      8 Articles
   </small>
   <p class="col-md-5 mx-auto text-gray-500 mt-2 font-light">
      {{author.bio|default:""}}
   </p>
   <ul class="list-inline author-profile-icon">

      <!-- Facebook -->
      {% if author.socialhandle.facebook %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.facebook}}">
            <i class='bx bxl-facebook text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}

      <!-- LinkedIn -->
      {% if author.socialhandle.linkedin %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.linkedin}}">
            <i class='bx bxl-linkedin-square text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}

      <!-- Twitter -->
      {% if author.socialhandle.twitter %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.twitter}}">
            <i class='bx bxl-twitter text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}

      <!-- Instagram -->
      {% if author.socialhandle.instagram %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.instagram}}">
            <i class='bx bxl-instagram text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}


      <!-- Youtube -->
      {% if author.socialhandle.youtube %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.youtube}}">
            <i class='bx bxl-youtube text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}

      <!-- Behance -->
      {% if author.socialhandle.behance %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.behance}}">
            <i class='bx bxl-behance text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}


      <!-- Dribble -->
      {% if author.socialhandle.dribbble %}
      <li class="list-inline-item">
         <a href="{{author.socialhandle.dribbble}}">
            <i class='bx bxl-dribbble text-sm border p-1 rounded-circle'></i>
         </a>
      </li>
      {% endif %}
   </ul>
</div>

{% if author_posts %}
   
<div class="container mt-5">
   <div class="mt-5 pt-5">
      <h3 class="mb-4">Latest posts from {{author.get_full_name}}</h3>
      <div class="row gy-4" data-masonry='{"percentPosition": true }'>
         {% for post in author_posts %}

         <div class="col-sm-6 col-lg-4 ">
            <div class="card border-0 ">
               <!-- Card img -->
               <div class="position-relative ">
                  <img class="card-img pointer-events-none" src="{{post.post_image.url}}" alt="Card image">
                  <div class="card-img-overlay d-flex align-items-start flex-column p-3">
                     <!-- Card overlay Top -->
                     <div class="w-100 mb-auto d-flex justify-content-end">
                        <div class="text-end ms-auto">
                           <!-- * Post Type -->
                           {% if post.post_type == video %}
                           <div class="icon-md bg-white bg-opacity-25 bg-blur text-white rounded-circle" data-bs-toggle="tooltip"
                              data-bs-title="This post has video" data-bs-placement="right">
                              <i class="fas fa-video"></i>
                           </div>
                           {% elif post.post_type == video %}
                           <div class="icon-md bg-white bg-opacity-25 bg-blur text-white rounded-circle" data-bs-toggle="tooltip"
                              data-bs-title="This post has video" data-bs-placement="right">
                              <i class="fa-solid fa-images text-md"></i>
                           </div>
                           {% endif %}
                        </div>
                     </div>
                     <!-- Card overlay bottom -->
                     <div class="w-100 mt-auto">
                        <!-- Card category -->
                        <a href="{% url 'category' post.category.slug %}"
                           class="badge text-xs text-bg-{{post.category.color}} mb-2 text-decoration-none font-outfit font-medium">
                           <i class="fa-solid fa-layer-group me-2"></i> {{post.category}}
                        </a>
                     </div>
                  </div>
               </div>
               <div class="card-body px-0 pt-3">
                  <div class="d-sm-flex justify-content-between">
                     <h4 class="card-title m-0 p-0 pb-2">
                        <a href="{% url 'blog:single_post' post.slug %}" class="btn-link text-reset fw-bold">
                           {{post.post_title}}
                        </a>
                     </h4>
         
                     {% if request.user.is_authenticated %}
                     <div class="w-fit col-1">
         
                        {% if request.user in post.bookmarks.all %}
                        <a href="{% url 'users:bookmarks' request.user.slug %}" class="text-decoration-none"
                           data-bs-toggle="tooltip" data-bs-title="Already in bookmarks" data-bs-placement="bottom">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                              <path
                                 d="M16.8203 2H7.18031C5.05031 2 3.32031 3.74 3.32031 5.86V19.95C3.32031 21.75 4.61031 22.51 6.19031 21.64L11.0703 18.93C11.5903 18.64 12.4303 18.64 12.9403 18.93L17.8203 21.64C19.4003 22.52 20.6903 21.76 20.6903 19.95V5.86C20.6803 3.74 18.9503 2 16.8203 2ZM15.0103 9.75C14.0403 10.1 13.0203 10.28 12.0003 10.28C10.9803 10.28 9.96031 10.1 8.99031 9.75C8.60031 9.61 8.40031 9.18 8.54031 8.79C8.69031 8.4 9.12031 8.2 9.51031 8.34C11.1203 8.92 12.8903 8.92 14.5003 8.34C14.8903 8.2 15.3203 8.4 15.4603 8.79C15.6003 9.18 15.4003 9.61 15.0103 9.75Z"
                                 fill="#292D32" />
                           </svg>
                        </a>
                        {% else %}
                        <a href="{% url 'users:bookmark_add' request.user.slug post.id %}" class="text-decoration-none"
                           data-bs-toggle="tooltip" data-bs-title="Add to bookmarks" data-bs-placement="bottom">
                           <i class="iconsax" style="--Iconsax-Size: 24px;--Iconsax-Color: #000;" icon-name="bookmark-add"></i>
                        </a>
                        {% endif %}
         
                     </div>
                     {% else %}
                     <div class="w-fit col-1">
                        <a href="{% url 'login' %}" class="text-decoration-none" data-bs-toggle="tooltip"
                           data-bs-title="Add to bookmarks" data-bs-placement="bottom">
                           <i class="iconsax" style="--Iconsax-Size: 24px;--Iconsax-Color: #000;" icon-name="bookmark-add"></i>
                        </a>
                     </div>
                     {% endif %}
                  </div>
                  <p class="card-text">
                     {{post.short_description}}
                  </p>
                  <!-- Card info -->
                  <ul class="nav nav-divider align-items-center d-none d-sm-inline-block">
                     <li class="nav-item">
                        <div class="nav-link">
                           <div class="d-flex align-items-center position-relative">
                              <div class="avatar avatar-xs">
                                 {% if post.post_author.profile_picture %}
                                 <img class="avatar-img rounded-circle" src="{{post.post_author.profile_picture.url}}"
                                    alt="avatar">
                                 {% else %}
                                 <img class="avatar-img rounded-circle" src="{% static 'img/user/custom.jpg' %}" alt="avatar">
                                 {% endif %}
                              </div>
                              <span class="ms-3">by
                                 <a 
                                    href="{% url 'author_external' post.post_author.slug %}"
                                    class="stretched-link text-reset btn-link"
                                    data-bs-toggle="popover"  
                                    data-bs-trigger="hover"
                                    data-bs-delay="500"
                                    data-bs-html="true"
                                    data-bs-container="body"
                                    data-bs-offset="10,20"                                 
                                    data-bs-content="
                                    <div>
                                       <h6 class='font-cabin font-medium m-0 p-0'>{{post.post_author.get_full_name}}</h6>
                                       <small class='font-medium font-outfit text-sm text-gray-500'>@{{post.post_author.get_username}}</small>
                                    </div>
                                 "
                                 >
                                    {{post.post_author.get_short_name}}
                                 </a>
                              </span>
                           </div>
                        </div>
                     </li>
                     <li class="nav-item">
                        {{post.date_posted|date:"dS M , Y"}}
                     </li>
                     <li class="nav-item">
                        <a href="#" class="btn-link">
                           <i class="fa-regular fa-comments me-1"></i> 5
                        </a>
                     </li>
                  </ul>
               </div>
            </div>
         </div>

         {% endfor %}
      </div>
   </div>
</div>

{% else %}

<div class="d-grid justify-content-center pt-5 mt-5">
   <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto" width="70" height="70" fill="#dc2626" viewBox="0 0 24 24">
      <path
         d="M11.953 2C6.465 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.493 2 11.953 2zM12 20c-4.411 0-8-3.589-8-8s3.567-8 7.953-8C16.391 4 20 7.589 20 12s-3.589 8-8 8z">
      </path>
      <path d="M11 7h2v7h-2zm0 8h2v2h-2z"></path>
   </svg>
   <h4 class="text-center mt-3">No Posts</h4>
   <p>This author has no posts yet.</p>
</div>

{% endif %}

{% elif reader %}

<div class="container-md mt-2">
   <div class="col-12">
      <div class="mb-4 position-relative z-index-9">
         <!-- Cover image -->
         <div class="py-5 rounded background-img rounded-lg h-200 " {% if reader.background_image %}
            style="background-image: url('{{reader.background_image.url}}');" {% else %}
            style="background-image: url('{% static " img/user/bkg_placeholder2.jpg" %}');" {% endif %}>
         </div>
         <div class="card-body pb-0">
            <div class="row d-flex flex-column justify-content-between">
               <!-- Avatar -->
               <div class="col-sm-12 col-md-auto text-center text-md-start mx-auto">
                  <div class="avatar avatar-xxl mt-n7">
                     {% if reader.profile_picture %}
                     <img class="avatar-img rounded-circle border border-white border-3 pointer-events-none"
                        src="{{reader.profile_picture.url}}" alt="">
                     {% else %}
                     <img class="avatar-img rounded-circle border border-white border-3 pointer-events-none"
                        src="{% static 'img/user/custom.jpg' %}" alt="">
                     {% endif %}
                  </div>
               </div>
               <div class="col-sm-12 mt-2 col-md text-center">
                  <div>
                     <!-- ? User fullname -->
                     <h4 class="m-0 p-0">
                        {{reader.get_full_name|default:"Firstname Lastname"}}
                        {% if reader.usersettings.is_verified %}
                        <svg xmlns="http://www.w3.org/2000/svg" class="verified-icon" viewBox="0 0 24 24">
                           <path
                              d="M19.965 8.521C19.988 8.347 20 8.173 20 8c0-2.379-2.143-4.288-4.521-3.965C14.786 2.802 13.466 2 12 2s-2.786.802-3.479 2.035C6.138 3.712 4 5.621 4 8c0 .173.012.347.035.521C2.802 9.215 2 10.535 2 12s.802 2.785 2.035 3.479A3.976 3.976 0 0 0 4 16c0 2.379 2.138 4.283 4.521 3.965C9.214 21.198 10.534 22 12 22s2.786-.802 3.479-2.035C17.857 20.283 20 18.379 20 16c0-.173-.012-.347-.035-.521C21.198 14.785 22 13.465 22 12s-.802-2.785-2.035-3.479zm-9.01 7.895-3.667-3.714 1.424-1.404 2.257 2.286 4.327-4.294 1.408 1.42-5.749 5.706z">
                           </path>
                        </svg>
                        {% endif %}
                     </h4>
                     <small class="font-medium text-gray-500">
                        @{{reader.get_username}}
                     </small>
                     <ul class="list-inline text-sm pt-1 mb-1">
                        <!-- ? User Job Title -->
                        {% if reader.job_title %}
                        <li class="list-inline-item">
                           <i class="fa-solid fa-user fa-sm me-1"></i>
                           {{reader.job_title}}
                        </li>
                        {% endif %}

                        <!-- ? User City -->
                        {% if reader.city %}
                        <li class="list-inline-item">
                           <i class="fa-solid fa-location-dot fa-sm me-1"></i>
                           {{reader.city}}
                        </li>
                        {% endif %}
                     </ul>
                     <p class="col-md-6 mx-auto text-gray-500 m-0 p-0 font-normal mb-3">
                        {{reader.bio}}
                     </p>
                  </div>
                  <!-- Links -->
                  <div class="d-flex align-items-center justify-content-center">
                     {% if request.user.is_authenticated %}
                     <a href="#" class="btn btn-blue btn-sm">Follow</a>
                     {% else %}
                     <a href="{% url 'login' %}" class="btn btn-blue btn-sm">Follow</a>
                     {% endif %}
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

{% endif %}
<br><br>

{% endblock %}